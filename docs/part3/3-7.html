<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Dyna - CS 7646: Machine Learning for Trading</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../welcome.html">Welcome</a></li><li class="chapter-item expanded "><a href="../part1/part1.html"><strong aria-hidden="true">1.</strong> Part 1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part1/1-1.html"><strong aria-hidden="true">1.1.</strong> Reading and plotting stock data</a></li><li class="chapter-item expanded "><a href="../part1/1-2.html"><strong aria-hidden="true">1.2.</strong> Working with multiple stocks</a></li><li class="chapter-item expanded "><a href="../part1/1-3.html"><strong aria-hidden="true">1.3.</strong> The power of NumPy</a></li><li class="chapter-item expanded "><a href="../part1/1-4.html"><strong aria-hidden="true">1.4.</strong> Statistical analysis of time series</a></li><li class="chapter-item expanded "><a href="../part1/1-5.html"><strong aria-hidden="true">1.5.</strong> Incomplete data</a></li><li class="chapter-item expanded "><a href="../part1/1-6.html"><strong aria-hidden="true">1.6.</strong> Histograms and scatter plots</a></li><li class="chapter-item expanded "><a href="../part1/1-7.html"><strong aria-hidden="true">1.7.</strong> Sharpe ratio and other portfolio statistics</a></li><li class="chapter-item expanded "><a href="../part1/1-8.html"><strong aria-hidden="true">1.8.</strong> Optimizers</a></li><li class="chapter-item expanded "><a href="../part1/1-9.html"><strong aria-hidden="true">1.9.</strong> How to optimize a portfolio</a></li></ol></li><li class="chapter-item expanded "><a href="../part2/part2.html"><strong aria-hidden="true">2.</strong> Part 2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part2/2-1.html"><strong aria-hidden="true">2.1.</strong> So you want to be a hedge fund manager?</a></li><li class="chapter-item expanded "><a href="../part2/2-2.html"><strong aria-hidden="true">2.2.</strong> Market mechanics</a></li><li class="chapter-item expanded "><a href="../part2/2-3.html"><strong aria-hidden="true">2.3.</strong> What is a company worth?</a></li><li class="chapter-item expanded "><a href="../part2/2-4.html"><strong aria-hidden="true">2.4.</strong> The capital assets pricing model (CAPM)</a></li><li class="chapter-item expanded "><a href="../part2/2-5.html"><strong aria-hidden="true">2.5.</strong> How hedge funds use the CAPM</a></li><li class="chapter-item expanded "><a href="../part2/2-6.html"><strong aria-hidden="true">2.6.</strong> Technical analysis</a></li><li class="chapter-item expanded "><a href="../part2/2-7.html"><strong aria-hidden="true">2.7.</strong> Dealing with data</a></li><li class="chapter-item expanded "><a href="../part2/2-8.html"><strong aria-hidden="true">2.8.</strong> Efficient markets hypothesis</a></li><li class="chapter-item expanded "><a href="../part2/2-9.html"><strong aria-hidden="true">2.9.</strong> The fundamental law of active portfolio management</a></li><li class="chapter-item expanded "><a href="../part2/2-10.html"><strong aria-hidden="true">2.10.</strong> Portfolio optimization and the efficient frontier</a></li></ol></li><li class="chapter-item expanded "><a href="../part3/part3.html"><strong aria-hidden="true">3.</strong> Part 3</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part3/3-1.html"><strong aria-hidden="true">3.1.</strong> How machine learning is used at a hedge fund</a></li><li class="chapter-item expanded "><a href="../part3/3-2.html"><strong aria-hidden="true">3.2.</strong> Regression</a></li><li class="chapter-item expanded "><a href="../part3/3-3.html"><strong aria-hidden="true">3.3.</strong> Assessing a learning algorithm</a></li><li class="chapter-item expanded "><a href="../part3/3-4.html"><strong aria-hidden="true">3.4.</strong> Ensemble learners - bagging and boosting</a></li><li class="chapter-item expanded "><a href="../part3/3-5.html"><strong aria-hidden="true">3.5.</strong> Reinforcement learning</a></li><li class="chapter-item expanded "><a href="../part3/3-6.html"><strong aria-hidden="true">3.6.</strong> Q-learning</a></li><li class="chapter-item expanded "><a href="../part3/3-7.html" class="active"><strong aria-hidden="true">3.7.</strong> Dyna</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CS 7646: Machine Learning for Trading</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="3-7-dyna"><a class="header" href="#3-7-dyna">3-7: Dyna</a></h1>
<p>The issue with Q-learning is you have to execute real trades to receive
feedback from the real world in order to converge while learning. Rich Sutton
invented Dyna to solve this problem. Dyna builds models of T, the
<strong>transition matrix</strong>, and R, the <strong>reward matrix</strong>, and then, after each
interaction with the real world, hallucinates many additions interactions -
usually a few hundred.</p>
<h2 id="dyna-q-big-picture"><a class="header" href="#dyna-q-big-picture">Dyna-Q big picture</a></h2>
<p>With Dyna-Q, we have a Q table that is influenced by real-world actions,
states, and rewards. After this expensive operation is done, we take those
findings and update our backend Dyna-Q T and R models. We conduct an iteration
100 times, learning about the information we just received from the real world
and this is used to update our Q-learner used for real-world solutions.</p>
<p><img src="./assets/dyna-q.png" alt="dyna-q" /></p>
<h2 id="learning-t"><a class="header" href="#learning-t">Learning T</a></h2>
<p>We start of with <strong>T</strong> being equal to <strong>0.00001</strong>. While executing, if we
observe a state of <strong>S</strong> transitioning to <strong>S prime</strong> due to some <strong>action</strong>,
we increment the counter for that respecting <strong>T</strong> location.</p>
<p><img src="./assets/learning-t.png" alt="learning-t" /></p>
<h2 id="evaluating-t"><a class="header" href="#evaluating-t">Evaluating T</a></h2>
<p>We evaluate <strong>T</strong> by determining the probability we'll end up here based upon
taking this action and arriving at this state, using historical data.
Essentially, we'll take <strong>Tc</strong>, number of times we've been at this state due
to <strong>action</strong> at <strong>S</strong>, and we'll divide that by the <strong>sum</strong> of the number of
times we've been at this <strong>state</strong> and have taken the same <strong>action</strong> and
arrived at a different or the same state. This essentially just iterates
through all states related to this action.</p>
<p>This gives us the probability of arriving at state <strong>S prime</strong>. Equation from
the lecture is provided below:</p>
<p><img src="./assets/evaluate-t.png" alt="evaluate-t" /></p>
<h2 id="learning-r"><a class="header" href="#learning-r">Learning R</a></h2>
<p><strong>R</strong> is the expected reward for a <strong>state</strong> and <strong>action</strong> and <strong>r</strong> is the
immediate reward we experienced for this state and action. <strong>R prime</strong> is the
update we make for this <strong>R</strong> after receiving new observations, and it's similar
to updating <strong>Q</strong>. Below is the equation for this:</p>
<p><img src="./assets/learning-r.png" alt="learning-r" /></p>
<h2 id="recap"><a class="header" href="#recap">Recap</a></h2>
<p>Below is a high-level recap from the lectures:</p>
<p><img src="./assets/recap.png" alt="recap" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../part3/3-6.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../part3/3-6.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:9000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
